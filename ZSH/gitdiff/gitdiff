#!/bin/bash

# Function to display verbose messages
verbose() {
  if [ "$verbose_mode" = true ]; then
    echo "$@"
  fi
}

# Initialize options
highlight_additions=false
highlight_deletions=false
verbose_mode=false

# Parse command-line arguments
while [[ "$1" =~ ^- ]]; do
  case $1 in
    --highlight-additions)
      highlight_additions=true
      ;;
    --highlight-deletions)
      highlight_deletions=true
      ;;
    -v | --verbose)
      verbose_mode=true
      ;;
    *)
      echo "Invalid option: $1"
      exit 1
      ;;
  esac
  shift
done

# Check for unstaged changes
if [ -z "$(git status --porcelain)" ]; then
  echo "No changes to show in the diff."
  exit 0
fi

# Function to run git diff with appropriate filters
run_diff() {
  if [ "$highlight_additions" = true ] && [ "$highlight_deletions" = true ]; then
    verbose "Showing both additions and deletions..."
    git diff --color
  elif [ "$highlight_additions" = true ]; then
    verbose "Showing only additions..."
    git diff --color | grep --color=always '^+[^+]' # Exclude diff headers ('+++')
  elif [ "$highlight_deletions" = true ]; then
    verbose "Showing only deletions..."
    git diff --color | grep --color=always '^-[^-]' # Exclude diff headers ('---')
  else
    verbose "Showing full diff..."
    git diff --color
  fi
}

# Run the diff with custom options
verbose "Running git diff..."
run_diff

